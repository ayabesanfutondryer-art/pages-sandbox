<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>衝動買い判断支援アプリ</title>
    <style>
        :root {
            --bg-color: #050505;
            --text-color: #e0e0e0;
            --accent-color: #1e90ff;
            --accent-hover: #00bfff;
            --border-color: #333;
            --font-family: 'Courier New', Consolas, monospace;
            /* Pixel/Typewriter feel */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: var(--font-family);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            line-height: 1.6;
        }

        /* Container to center content */
        #app {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 10;
        }

        /* Utility classes */
        .hidden {
            display: none !important;
        }

        .screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1,
        h2 {
            margin-bottom: 2rem;
            color: var(--text-color);
            text-shadow: 2px 2px 0px #000;
        }

        p {
            margin-bottom: 1.5rem;
        }

        /* Pixel Art Style Inputs & Buttons */
        input[type="text"] {
            background-color: #000;
            border: 2px solid var(--text-color);
            color: var(--text-color);
            padding: 10px;
            font-size: 1.2rem;
            width: 80%;
            margin-bottom: 2rem;
            outline: none;
            box-shadow: 4px 4px 0px var(--accent-color);
            transition: box-shadow 0.2s;
        }

        input[type="text"]:focus {
            box-shadow: 2px 2px 0px var(--accent-hover);
            border-color: var(--accent-color);
        }

        button {
            background-color: #000;
            color: var(--text-color);
            border: 2px solid var(--accent-color);
            padding: 15px 30px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px;
            min-width: 120px;
            box-shadow: 4px 4px 0px var(--accent-color);
            text-transform: uppercase;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        button:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px var(--accent-hover);
            border-color: var(--accent-hover);
            color: var(--accent-hover);
        }

        button:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }

        button.secondary {
            border-color: var(--border-color);
            box-shadow: 4px 4px 0px var(--border-color);
            color: #888;
        }

        button.secondary:hover {
            color: #ccc;
            border-color: #ccc;
            box-shadow: 2px 2px 0px #ccc;
        }

        /* Speech Bubble */
        .bubble {
            background: #000;
            border: 2px solid var(--text-color);
            padding: 20px;
            margin-bottom: 30px;
            position: relative;
            max-width: 90%;
            box-shadow: 6px 6px 0px rgba(30, 144, 255, 0.3);
            z-index: 20;
        }

        /* Sphere Character */
        #character-bg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--accent-color), #000 70%);
            box-shadow: 0 0 50px rgba(30, 144, 255, 0.2);
            z-index: 1;
            /* Behind UI */
            pointer-events: none;
            transition: width 0.8s ease, height 0.8s ease, opacity 0.5s;
        }

        /* Screen specific character sizes */
        body[data-screen="home"] #character-bg {
            width: 150px;
            height: 150px;
            opacity: 0.8;
        }

        body[data-screen="input"] #character-bg {
            width: 200px;
            height: 200px;
            opacity: 0.6;
        }

        body[data-screen="question"] #character-bg {
            width: 250px;
            height: 250px;
            opacity: 0.5;
        }

        body[data-screen="summary"] #character-bg {
            width: 400px;
            height: 400px;
            opacity: 0.4;
        }

        body[data-screen="decision"] #character-bg {
            width: 500px;
            height: 500px;
            opacity: 0.3;
        }

        body[data-screen="comment"] #character-bg {
            width: 300px;
            height: 300px;
            opacity: 0.6;
        }

        /* Question Progress */
        .progress {
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--accent-color);
        }

        /* List for summary */
        ul.reason-list {
            list-style: none;
            /* Custom marks */
            text-align: left;
            margin: 10px 0;
            width: 100%;
        }

        ul.reason-list li {
            padding: 5px 0;
            padding-left: 1.5em;
            position: relative;
        }

        ul.reason-list li::before {
            content: ">";
            position: absolute;
            left: 0;
            color: var(--accent-color);
        }

        /* Button Group */
        .btn-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
    </style>
</head>

<body data-screen="home">

    <!-- Character Background -->
    <div id="character-bg"></div>

    <!-- Application Container -->
    <div id="app">

        <!-- 1. Home Screen -->
        <div id="screen-home" class="screen">
            <h1>判断サポーター</h1>
            <p>冷静な判断を支援します</p>
            <button onclick="router.navigate('input')">判断開始</button>
        </div>

        <!-- 2. Target Input Screen -->
        <div id="screen-input" class="screen hidden">
            <p>今、買うか迷っているものを入力してください</p>
            <input type="text" id="target-input" placeholder="例：新しい服 / イヤホン" autocomplete="off">
            <div class="btn-group">
                <button class="secondary" onclick="router.navigate('home')">戻る</button>
                <button onclick="app.submitTarget()">次へ</button>
            </div>
        </div>

        <!-- 3. Question Screen -->
        <div id="screen-question" class="screen hidden">
            <div class="progress" id="q-progress">1/5</div>
            <div class="bubble">
                <p id="q-text">質問テキスト...</p>
            </div>
            <div class="btn-group">
                <button onclick="app.answerQuestion(true)">Yes</button>
                <button onclick="app.answerQuestion(false)">No</button>
            </div>
        </div>

        <!-- 4. Summary Screen -->
        <div id="screen-summary" class="screen hidden">
            <div class="bubble" id="summary-content">
                <!-- Dynamic Content -->
            </div>
            <button onclick="app.nextSummary()">次へ</button>
        </div>

        <!-- 5. Decision Screen -->
        <div id="screen-decision" class="screen hidden">
            <h2 id="decision-target-display">（ターゲット）を買う？買わない？</h2>
            <div class="btn-group">
                <button onclick="app.makeDecision('buy')">買う</button>
                <button onclick="app.makeDecision('dont')">買わない</button>
            </div>
        </div>

        <!-- 6. Comment Screen -->
        <div id="screen-comment" class="screen hidden">
            <div class="bubble">
                <p id="comment-text">コメント...</p>
            </div>
            <button onclick="app.reset()">最初に戻る</button>
        </div>

    </div>

    <script>
        // --- State ---
        const state = {
            targetText: "この商品",
            currentQIndex: 0,
            answers: {}, // { qId: boolean }
            buyReasons: [],
            dontReasons: [],
            finalDecision: null,
            summaryStep: 0, // 0: buy reasons, 1: dont reasons
        };

        // --- Data: Questions ---
        const questions = [
            {
                id: 1,
                text: "今のあなたは、疲れていたり、ストレスが溜まっていたりしますか？",
                yesType: "dont", // Yes -> dontReasons
                noType: "buy",   // No -> buyReasons
                reasons: {
                    dont: "今、疲れやストレスが判断に影響している可能性がある。",
                    buy: "今、比較的落ち着いた状態で（ターゲット）を見ている。"
                }
            },
            {
                id: 2,
                text: "数量限定、希少価値、期間限定という言葉に影響されていませんか？",
                yesType: "dont",
                noType: "buy",
                reasons: {
                    dont: "数量限定、希少価値、期間限定という要素に影響されている可能性がある。",
                    buy: "「限定・希少・期間」に左右されず（ターゲット）を見ている。"
                }
            },
            {
                id: 3,
                text: "これを買ったことで、半年後の自分は満足していそうですか？",
                yesType: "buy",
                noType: "dont",
                reasons: {
                    buy: "半年後も（ターゲット）に満足していそうだと考えている。",
                    dont: "半年後の満足に自信が持てていない。"
                }
            },
            {
                id: 4,
                text: "これを買わなかった場合、明日のあなたは困りますか？",
                yesType: "buy",
                noType: "dont",
                reasons: {
                    buy: "（ターゲット）が明日に必要だと考えている。",
                    dont: "（ターゲット）が明日なくても困らないと考えている。"
                }
            },
            {
                id: 5,
                text: "同じような機能の物をすでに持っていますか？",
                yesType: "dont",
                noType: "buy",
                reasons: {
                    dont: "同じような機能の物をすでに持っている。",
                    buy: "同等の代替を持っていないと考えている。"
                }
            }
        ];

        // --- Router & View Logic ---
        const router = {
            screens: ['home', 'input', 'question', 'summary', 'decision', 'comment'],
            navigate: (screenName) => {
                // Update CSS Hook for Character Size
                document.body.setAttribute('data-screen', screenName);

                // Toggle Visibility
                router.screens.forEach(s => {
                    const el = document.getElementById(`screen-${s}`);
                    if (s === screenName) {
                        el.classList.remove('hidden');
                    } else {
                        el.classList.add('hidden');
                    }
                });
            }
        };

        // --- App Logic ---
        const app = {
            init: () => {
                // Initial setup if needed
            },

            submitTarget: () => {
                const input = document.getElementById('target-input');
                const val = input.value.trim();
                state.targetText = val || "この商品";
                state.currentQIndex = 0;

                // Clear previous state just in case
                state.answers = {};
                state.buyReasons = [];
                state.dontReasons = [];

                app.renderQuestion();
                router.navigate('question');
            },

            renderQuestion: () => {
                const q = questions[state.currentQIndex];
                document.getElementById('q-progress').textContent = `${state.currentQIndex + 1} / ${questions.length}`;
                document.getElementById('q-text').textContent = q.text;
            },

            answerQuestion: (isYes) => {
                // Save answer
                state.answers[state.currentQIndex] = isYes; // just for record if needed

                // Logic to push reasons
                const q = questions[state.currentQIndex];
                const type = isYes ? q.yesType : q.noType;
                const reasonTemplate = q.reasons[type];
                const reasonText = reasonTemplate.replace(/（ターゲット）/g, state.targetText);

                if (type === 'buy') {
                    state.buyReasons.push(reasonText);
                } else {
                    state.dontReasons.push(reasonText);
                }

                // Next question or finish
                state.currentQIndex++;
                if (state.currentQIndex < questions.length) {
                    app.renderQuestion();
                } else {
                    // Start summary
                    state.summaryStep = 0;
                    app.renderSummary();
                    router.navigate('summary');
                }
            },

            renderSummary: () => {
                const container = document.getElementById('summary-content');
                container.innerHTML = ''; // clear

                if (state.summaryStep === 0) {
                    // Buying Reasons
                    const intro = `<p><strong>${state.targetText}</strong>について</p>`;
                    let listHtml = '';
                    if (state.buyReasons.length > 0) {
                        listHtml = `<ul class="reason-list">${state.buyReasons.map(r => `<li>${r}</li>`).join('')}</ul>`;
                    } else {
                        listHtml = `<p>買う理由は、今回の回答からは強く出ていない。</p>`;
                    }
                    const outro = `<p>と考えている。</p>`;
                    container.innerHTML = intro + listHtml + outro;
                } else {
                    // Don't Buying Reasons
                    const intro = `<p>一方で、</p>`;
                    let listHtml = '';
                    if (state.dontReasons.length > 0) {
                        listHtml = `<ul class="reason-list">${state.dontReasons.map(r => `<li>${r}</li>`).join('')}</ul>`;
                    } else {
                        listHtml = `<p>買わない理由は、今回の回答からは強く出ていない。</p>`;
                    }
                    const outro = `<p>とも考えている。</p>`;
                    container.innerHTML = intro + listHtml + outro;
                }
            },

            nextSummary: () => {
                if (state.summaryStep === 0) {
                    state.summaryStep = 1;
                    app.renderSummary(); // Re-render for step 2
                } else {
                    // Go to decision
                    document.getElementById('decision-target-display').textContent = `${state.targetText}を買う？買わない？`;
                    router.navigate('decision');
                }
            },

            makeDecision: (decision) => {
                state.finalDecision = decision;
                const commentEl = document.getElementById('comment-text');
                if (decision === 'buy') {
                    commentEl.textContent = "整理した上で選んだなら、それはあなたの意志だ。";
                } else {
                    commentEl.textContent = "冷静な判断です";
                }
                router.navigate('comment');
            },

            reset: () => {
                state.targetText = "この商品";
                state.currentQIndex = 0;
                state.answers = {};
                state.buyReasons = [];
                state.dontReasons = [];
                state.finalDecision = null;
                state.summaryStep = 0;

                document.getElementById('target-input').value = "";
                router.navigate('home');
            }
        };

        // Initialize
        console.log("App initialized");
    </script>
</body>

</html>